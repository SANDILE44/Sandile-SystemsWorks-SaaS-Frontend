<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sandile SystemsWorks - Dashboard</title>
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <!-- HEADER -->
    <header class="header">
      <div class="container">
        <div class="header-inner">
          <!-- BRAND -->
          <div class="brand">
            <img
              src="images/Untitled design.png"
              alt="Sandile SystemsWorks"
              class="brand-logo"
            />
            <span class="brand-name">Sandile SystemsWorks</span>
          </div>

          <!-- RIGHT ACTIONS -->
          <div class="header-actions">
            <button
              type="button"
              onclick="window.auth.logout()"
              class="btn btn-ghost"
            >
              Logout
            </button>
          </div>
        </div>
      </div>
    </header>

    <main>
      <h1>Business Calculators</h1>
      <p>
        Welcome, <span id="usernameDisplay"></span>. Choose a sector to begin.
      </p>

      <div id="payBox" style="margin: 16px 0"></div>

      <div class="cards-grid">
        <!-- PRIMARY SECTOR -->
        <div class="card">
          <h3 class="card-title">Primary Sector</h3>
          <p>
            Agriculture, Forestry, Fishing, Mining, Oil &amp; Gas, Renewable
            Energy
          </p>
          <a href="sector-primary.html">Explore Calculators →</a>
        </div>

        <!-- SECONDARY SECTOR -->
        <div class="card">
          <h3 class="card-title">Secondary Sector</h3>
          <p>
            Manufacturing, Construction, Automotive, Electronics, Textiles, Food
            &amp; Beverage
          </p>
          <a href="sector-secondary.html">Explore Calculators →</a>
        </div>

        <!-- TERTIARY SECTOR -->
        <div class="card">
          <h3 class="card-title">Tertiary Sector</h3>
          <p>
            Real Estate, Retail, Restaurants, Hospitality, Logistics,
            Healthcare, Education, Finance, Marketing, Consulting
          </p>
          <a href="sector-tertiary.html">Explore Calculators →</a>
        </div>

        <!-- QUATERNARY SECTOR -->
        <div class="card">
          <h3 class="card-title">Quaternary Sector</h3>
          <p>Software, SaaS, IT Services, Media, R&amp;D, Telecommunications</p>
          <a href="sector-quaternary.html">Explore Calculators →</a>
        </div>

        <!-- QUINARY SECTOR -->
        <div class="card">
          <h3 class="card-title">Quinary Sector</h3>
          <p>
            Government, NGOs, Social &amp; Community Services, Public
            Administration
          </p>
          <a href="sector-quinary.html">Explore Calculators →</a>
        </div>
      </div>
    </main>

    <!-- IMPORTANT: load scripts first -->
    <script src="js/config.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>

    <script>
      // ✅ correct call (because requireAccess is inside window.auth)
      window.auth.requireAccess();

      (async () => {
        const profile = await window.auth.requireAuth();
        if (!profile) return;

        const el = document.getElementById("usernameDisplay");
        if (el) el.textContent = profile.user?.name || "User";

        const payBox = document.getElementById("payBox");
        if (!payBox) return;

        if (profile.user?.hasPaid) {
          payBox.innerHTML = `<p style="color:#00ff7f;">✅ Active Subscription</p>`;
          return;
        }

        payBox.innerHTML = `
          <p style="color:#ffcc00;">Your account is not paid yet.</p>
          <button type="button" class="btn-primary" id="payBtn">Pay now</button>
        `;

        document
          .getElementById("payBtn")
          .addEventListener("click", async () => {
            try {
              const token = window.auth.getToken();
              const data = await window.api.createCheckoutRequest(token);
              window.location.href = data.checkoutUrl;
            } catch (e) {
              alert(e.message || "Checkout failed");
            }
          });
      })();
    </script>
  </body>
</html>
